<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Catheter Site Triage</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <div class="app-shell">
      <header class="hero">
        <p class="subhead">AI-assisted care</p>
        <h1>Catheter Site Triage</h1>
        <p class="hero-copy">Capture catheter and traction imagery every 12 hours, log dressing events, and receive CLISA-aligned recommendations.</p>
      </header>

      <main>
        <section id="screenUpload" class="screen active" aria-label="Upload screen">
          <div class="card primary capture-card">
            <h2>Collect imagery</h2>
            <p>Use a recent, well-lit image or capture a new frame. Images remain on-device except for secure analysis.</p>
            <div class="capture-controls">
              <label class="field-label">Capture type</label>
              <div class="chip-toggle" role="group" aria-label="Capture type">
                <label>
                  <input type="radio" name="captureType" value="catheter_site" checked />
                  <span>Catheter site</span>
                </label>
                <label>
                  <input type="radio" name="captureType" value="traction_module" />
                  <span>Traction module</span>
                </label>
              </div>
              <label class="field-label" for="eventMarker">Event marker (dot on trend)</label>
              <select id="eventMarker">
                <option value="">None</option>
                <option value="dressing_change">Dressing change (âšª white)</option>
                <option value="catheter_change">Catheter replacement (âš« black)</option>
              </select>
              <label class="night-toggle">
                <input type="checkbox" id="nightModeToggle" />
                <span>Enable night-mode assist for low light</span>
              </label>
            </div>
            <div class="input-group">
              <input type="file" id="imageInput" accept="image/*" />
              <button id="analyzeBtn" class="btn primary">Analyze photo</button>
            </div>
            <div class="divider"><span>or</span></div>
            <input type="file" id="cameraInput" accept="image/*" capture="environment" hidden />
            <button id="cameraBtn" class="btn outline">Capture with camera</button>
            <p class="note">Tip: hold the device steady 20 cm from the site for best clarity.</p>
          </div>
          <div id="status" class="status" aria-live="polite"></div>

          <div class="card consent-card">
            <div class="card-head">
              <h3>Audio patient consent</h3>
              <span class="chip muted">Hindi + English</span>
            </div>
            <p>Play consent aloud before capturing imagery. Buttons trigger on-device speech only.</p>
            <div class="consent-actions">
              <button id="consentHindi" class="btn tertiary" type="button">Play Hindi consent</button>
              <button id="consentEnglish" class="btn tertiary" type="button">Play English consent</button>
            </div>
            <details>
              <summary>View scripted text</summary>
              <blockquote>
                <strong>Hindi:</strong> â€œAapki suraksha ke liye hum IV lagne wale jagah ki ek tasveer lenge... Humara maksad sirf aapki nas ko safe rakhna hai.â€
              </blockquote>
              <blockquote>
                <strong>English:</strong> â€œFor your safety, we will take a picture of the IV site... our only aim is to keep your vein safe.â€
              </blockquote>
            </details>
          </div>

          <div class="card protocol-card">
            <div class="card-head">
              <h3>Picture-capture protocol</h3>
              <span class="chip muted">12-hour cycle</span>
            </div>
            <table class="protocol-table" aria-label="Capture protocol">
              <thead>
                <tr><th>Picture type</th><th>Purpose</th></tr>
              </thead>
              <tbody>
                <tr><td>Catheter site</td><td>Dressing failure + CLISA scoring</td></tr>
                <tr><td>Traction module</td><td>Count status of traction alerts</td></tr>
              </tbody>
            </table>
            <ul class="protocol-list">
              <li>Night-mode assist brightens the preview for low-light bays.</li>
              <li>If capture fails, the UI shows â€œImage capture failed â€“ retryâ€.</li>
              <li>Ensure both photos are logged every 12 hours.</li>
            </ul>
          </div>

          <div class="card context-card">
            <h3>Patient context</h3>
            <label for="insertionInput" class="field-label">IV insertion date &amp; time</label>
            <input type="datetime-local" id="insertionInput" />
            <p class="note">Dwell time drives Early (0â€“3d), Late (3â€“7d), and Extended risk logic.</p>
            <div class="factor-grid">
              <label><input type="checkbox" data-factor="agitation" /> Agitation / delirium</label>
              <label><input type="checkbox" data-factor="age_extremes" /> Age or weight extremes</label>
              <label><input type="checkbox" data-factor="comorbidities" /> Comorbidities (DM/CKD/GI)</label>
              <label><input type="checkbox" data-factor="immune_nutrition" /> Immune / nutrition compromise</label>
            </div>
            <div class="traction-grid">
              <div>
                <p class="field-label">Yellow traction alerts (past 12 h)</p>
                <div class="stepper">
                  <button type="button" id="tractionMinus" aria-label="Decrease traction alerts">âˆ’</button>
                  <output id="tractionCount" aria-live="polite">0</output>
                  <button type="button" id="tractionPlus" aria-label="Increase traction alerts">+</button>
                </div>
              </div>
              <label>
                <span class="field-label">Traction status</span>
                <select id="tractionStatus">
                  <option value="green">Stable</option>
                  <option value="yellow">Tension</option>
                  <option value="red">Red traction alert</option>
                </select>
              </label>
            </div>
          </div>

          <details class="card accordion" open>
            <summary>Assessment guide</summary>
            <ul class="guide-list">
              <li><strong>Lighting</strong> â€” ensure even, shadow-free lighting for accurate surface cues.</li>
              <li><strong>Framing</strong> â€” keep the catheter hub centered, 15â€“25 cm from the lens.</li>
              <li><strong>Dressings</strong> â€” remove glare by angling slightly; avoid filters or flash.</li>
              <li><strong>Escalation</strong> â€” Red label indicates urgent clinician review.</li>
            </ul>
          </details>

          <details class="card accordion" id="historyPanel">
            <summary>Assessment history</summary>
            <div id="historyList" class="history-list">
              <p class="note">No assessments stored yet.</p>
            </div>
          </details>
        </section>

        <section id="screenResults" class="screen" aria-label="Results screen" aria-hidden="true">
          <div class="card summary">
            <div class="summary-head">
              <p class="summary-label">Latest assessment</p>
              <span id="confidence" class="chip muted">Confidence â€”</span>
            </div>
            <div class="status-row">
              <span id="statusDot" class="status-dot neutral" aria-hidden="false"></span>
              <div>
                <h2 id="label">Awaiting scan</h2>
                <p id="risk">Risk score: â€”</p>
              </div>
            </div>
            <p id="explanation">Run an analysis to view triage guidance.</p>
          </div>

          <div class="card clisa-card">
            <div class="clisa-row">
              <div>
                <p class="summary-label">CLISA score</p>
                <strong id="clisaScore" class="clisa-value">â€”</strong>
              </div>
              <div class="risk-meter" aria-label="Risk meter">
                <div id="riskMeterFill"></div>
              </div>
            </div>
            <p id="clisaAction" class="clisa-action">CLISA action will appear here.</p>
            <div class="meter-meta">
              <span id="riskWindow">â€”</span>
              <span id="riskTier">Risk tier â€”</span>
              <button id="clisaGuideBtn" class="btn tertiary" type="button">Open CLISA table</button>
            </div>
          </div>

          <div class="card indicators">
            <h3>Indicators</h3>
            <div id="indicatorList" class="indicator-grid"></div>
          </div>

          <div class="card alerts-card">
            <div class="card-head">
              <h3>Active alerts</h3>
              <span class="chip muted">Real-time</span>
            </div>
            <div id="alertsList" class="alerts-list">
              <p class="note">No active alerts.</p>
            </div>
          </div>

          <div class="card trend-card">
            <div class="card-head">
              <h3>12-hour trend + events</h3>
              <span class="chip muted">Green/Yellow/Red + âšª/âš«</span>
            </div>
            <canvas id="trendChart" height="200" aria-label="Risk trend chart"></canvas>
            <div class="trend-legend">
              <span>ğŸŸ¢ Low</span>
              <span>ğŸŸ¡ Moderate</span>
              <span>ğŸ”´ High</span>
              <span>âšª Dressing change</span>
              <span>âš« Catheter change</span>
            </div>
          </div>

          <div class="card analytics-card">
            <div class="card-head">
              <h3>Ward-level analytics</h3>
              <span class="chip muted">CLABSI documentation</span>
            </div>
            <div id="analyticsGrid" class="analytics-grid">
              <div>
                <p>CLABSI rate</p>
                <strong id="metricRate">0</strong>
              </div>
              <div>
                <p>Central line days</p>
                <strong id="metricDays">0</strong>
              </div>
              <div>
                <p>Dressing changes (âšª)</p>
                <strong id="metricDressings">0</strong>
              </div>
              <div>
                <p>Catheter changes (âš«)</p>
                <strong id="metricCatheters">0</strong>
              </div>
              <div>
                <p>Traction alerts logged</p>
                <strong id="metricTraction">0</strong>
              </div>
            </div>
          </div>

          <details class="card details" id="clisaTable">
            <summary>CLISA reference table</summary>
            <table class="clisa-table">
              <thead>
                <tr><th>Score</th><th>Colour</th><th>Recommended action</th></tr>
              </thead>
              <tbody>
                <tr><td>0-29</td><td>ğŸŸ¢ Low</td><td>Routine surveillance, repeat in 12 h</td></tr>
                <tr><td>30-64</td><td>ğŸŸ¡ Moderate</td><td>Reinforce dressing, reassess within 2 h</td></tr>
                <tr><td>65+</td><td>ğŸ”´ High</td><td>Urgent clinician review + escalate protocol</td></tr>
              </tbody>
            </table>
          </details>

          <details class="card details">
            <summary>Full assessment data</summary>
            <div id="rawjson" class="json-view"></div>
          </details>

          <button id="newScanBtn" class="btn secondary">Run another scan</button>
        </section>
      </main>
    </div>

    <div id="cameraOverlay" class="camera-overlay" aria-hidden="true">
      <div class="camera-frame">
        <video id="cameraStream" autoplay playsinline></video>
        <div class="camera-actions">
          <button id="captureBtn" class="btn primary" type="button">Capture frame</button>
          <button id="closeCameraBtn" class="btn secondary" type="button">Cancel</button>
        </div>
      </div>
    </div>
    <script src="app.js"></script>
  </body>
</html>
